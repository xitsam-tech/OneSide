
<!doctype html><html lang="de"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>OneSide – Python Edition</title>
<style>
body{font-family:Inter,system-ui,Arial,sans-serif;background:#0b1220;color:#e5e7eb;margin:0}
.wrap{max-width:1200px;margin:0 auto;padding:18px}
h2{margin:0 0 10px 0}
.panel{background:#0f172a;border:1px solid #1f2937;border-radius:12px;padding:14px;margin-bottom:12px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.coin{border:1px solid #1f2937;border-radius:10px;padding:8px;margin:4px 0}
.small{font-size:12px;opacity:.8}
.badge{font-size:12px;background:#222b3f;padding:2px 8px;border-radius:999px;margin-left:6px}
.btn{background:#5b21b6;border:0;color:#fff;padding:6px 10px;border-radius:8px;cursor:pointer}
select, input[type=checkbox]{accent-color:#5b21b6}
.trend-on .coin.trend-up   { background: rgba(34,197,94,.08);  border-color: rgba(34,197,94,.25); }
.trend-on .coin.trend-mid  { background: rgba(245,158,11,.08); border-color: rgba(245,158,11,.25); }
.trend-on .coin.trend-down { background: rgba(239,68,68,.08);  border-color: rgba(239,68,68,.25); }
a{color:#93c5fd;text-decoration:none}
a:hover{text-decoration:underline}
</style>
</head><body>
<div class="wrap">
  <div class="panel grid">
    <div>
      <h2>Top‑Coins <span id="vsBadge" class="badge">EUR</span></h2>
      <div class="small">Quelle: Python APIs (CG → CoinLore → Binance + FX)</div>
      <div style="margin:8px 0">
        <label>Währung: <select id="vs">
          <option>EUR</option><option>USD</option><option>GBP</option><option>JPY</option>
        </select></label>
        <label style="margin-left:12px"><input id="trendToggle" type="checkbox"> Trendfarben</label>
      </div>
      <div id="coins"></div>
    </div>
    <div>
      <h2>Krypto‑Pulse <span class="badge small" id="pulseStatus">–</span></h2>
      <ul id="pulse" class="small"></ul>
    </div>
  </div>

  <div class="panel">
    <h2>Geopolitik & Makro (kompakt) <span class="badge" id="geoStatus">–</span></h2>
    <div style="margin:6px 0">
      <button class="btn" id="geoReload">Neu laden</button>
      <label style="margin-left:10px">Sprache <select id="geoLang"><option>EN</option><option>DE</option></select></label>
      <label style="margin-left:10px"><input id="transGlobalToggle" type="checkbox"> Webseitenübersetzer aktiv</label>
      <span class="small">Zielsprache:</span>
      <label><input type="radio" name="translang" value="en"> EN</label>
      <label><input type="radio" name="translang" value="de"> DE</label>
    </div>
    <ul id="geoList"></ul>
  </div>
</div>

<script>
const $=s=>document.querySelector(s);
let VS='EUR', TREND=false, TRANS_ON=(localStorage.getItem('transGlobalOn')||'off')==='on', TRANS_LANG=(localStorage.getItem('transLang')||'en');
let GEO_LANG=(localStorage.getItem('geoLang')||'EN').toUpperCase();

function wrapTranslate(u){
  try{ new URL(u); }catch(_){ return u; }
  return TRANS_ON ? `https://translate.google.com/translate?sl=auto&tl=${encodeURIComponent(TRANS_LANG)}&u=${encodeURIComponent(u)}` : u;
}
function applyTrend(){
  document.body.classList.toggle('trend-on', TREND);
  document.querySelectorAll('.coin').forEach(el=>{
    const v=parseFloat(el.getAttribute('data-change'))||0;
    el.classList.remove('trend-up','trend-mid','trend-down');
    el.classList.add(v>1.5?'trend-up':(v<-1.5?'trend-down':'trend-mid'));
  });
}

async function loadCoins(){
  $('#vsBadge').textContent=VS;
  const r=await fetch(`/api/top_coins?vs=${VS}&limit=10`);
  const j=await r.json(); const box=$('#coins'); box.innerHTML='';
  j.items.forEach(c=>{
    const el=document.createElement('div'); el.className='coin'; el.setAttribute('data-change', c.ch24||0);
    el.textContent = `${c.rank?c.rank+'. ':''}${c.symbol}  ${new Intl.NumberFormat(undefined,{style:'currency',currency:VS}).format(c.price||0)}  (${(c.ch24||0).toFixed(2)}%)`;
    box.appendChild(el);
  }); applyTrend();
}

async function loadPulse(){
  $('#pulseStatus').textContent='…';
  const r=await fetch('/api/metrics'); const m=await r.json();
  const ul=$('#pulse'); ul.innerHTML='';
  ul.innerHTML += `<li>BTC‑Dominanz: <b>${m.btc_dominance?.toFixed ? m.btc_dominance.toFixed(1) : '–'}%</b></li>`;
  ul.innerHTML += `<li>ETH/BTC: <b>${m.eth_btc??'–'}</b></li>`;
  ul.innerHTML += `<li>Funding (BTC): <b>${(m.funding?.BTC??0)*100}%</b> · Funding (ETH): <b>${(m.funding?.ETH??0)*100}%</b></li>`;
  ul.innerHTML += `<li>FGI: <b>${m.fear_greed?.value??'–'}</b> (${m.fear_greed?.class||'–'})</li>`;
  ul.innerHTML += `<li>BTC Fee (fast/med/slow): <b>${m.fees?.fast||'–'}/${m.fees?.medium||'–'}/${m.fees?.slow||'–'}</b> sat/vB</li>`;
  $('#pulseStatus').textContent='ok';
}

async function loadGeo(){
  $('#geoStatus').textContent='…';
  const r=await fetch('/api/geo_feed'); const j=await r.json();
  const items=j.items||[];
  const s=await fetch('/api/summary',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({items:items.slice(0,6),lang:GEO_LANG})});
  const sj=await s.json().catch(()=>({})); const bullets=Array.isArray(sj.bullets)?sj.bullets:[];
  const ul=$('#geoList'); ul.innerHTML='';
  for(let i=0;i<Math.min(items.length,4);i++){
    const it=items[i]; const b=bullets[i] || it.title;
    const li=document.createElement('li'); const a=document.createElement('a');
    a.href=wrapTranslate(it.url); a.target='_blank'; a.textContent=`${it.domain} – ${it.title.slice(0,120)}`;
    li.textContent='• '+b+' ('; li.appendChild(a); li.appendChild(document.createTextNode(')')); ul.appendChild(li);
  }
  $('#geoStatus').textContent='ok';
}

document.addEventListener('DOMContentLoaded', ()=>{
  $('#vs').value=VS;
  $('#vs').addEventListener('change', e=>{ VS=e.target.value; localStorage.setItem('vs',VS); loadCoins(); });
  $('#trendToggle').checked = (localStorage.getItem('trendCards')||'off')==='on';
  TREND = $('#trendToggle').checked; applyTrend();
  $('#trendToggle').addEventListener('change', e=>{ TREND=!!e.target.checked; localStorage.setItem('trendCards', TREND?'on':'off'); applyTrend(); });

  $('#transGlobalToggle').checked = TRANS_ON;
  document.querySelectorAll('input[name=translang]').forEach(r=>{
    r.checked = (r.value===TRANS_LANG);
    r.addEventListener('change', e=>{ if(e.target.checked){ TRANS_LANG=e.target.value; localStorage.setItem('transLang',TRANS_LANG); }});
  });
  $('#transGlobalToggle').addEventListener('change', e=>{ TRANS_ON=!!e.target.checked; localStorage.setItem('transGlobalOn', TRANS_ON?'on':'off'); });

  $('#geoLang').value = GEO_LANG;
  $('#geoLang').addEventListener('change', e=>{ GEO_LANG=e.target.value; localStorage.setItem('geoLang',GEO_LANG); loadGeo(); });
  $('#geoReload').addEventListener('click', ()=> loadGeo());

  loadCoins(); loadPulse(); loadGeo();
});
</script>
</body></html>
